# InfantCRefLibrary

InfantCRefLibrary

AUTHOR : Ryan Larsen
Copyright (c) 2021, University of Illinois at Urbana-Champaign. All rights reserved.

"AppSourceCode.mlapp" is the source code for an app that has been shared at the Illinois Databank: https://doi.org/10.13012/B2IDB-3548139_V1. 
  
"run_script_matlab.m" is a Matlab script that be used to perform the same functions as the app, but without a GUI interface.

The app and script allows for the comparison of user-provided Magnetic Resonance Spectroscopy (MRS) data from infants from birth to four months of age with a library of typically developing infants.  They also allows exploration of our database on 181 MRS scans.

The app and the calculations it performs are described in our recent publication: "Quantification of Magnetic Resonance Spectroscopy data using a combined reference: Application in typically developing infants" in NMR in Biomedicine by Larsen RJ, et al, 2021.

A demonstration video of the app can be found here: https://mediaspace.illinois.edu/media/t/1_sl2kjnkk

The app and the script require normative data used for calculations and plots. This data is contained in the "App_data.mat" file found in the "Combined_Data" directory at the Illinois DataBank: https://doi.org/10.13012/B2IDB-3548139_V1.  Place this data file in the same folder as the app and/or script.  

The spectra used to create the "App_data.mat" file are available at the Illinois Databank:  https://doi.org/10.13012/B2IDB-3548139_V1.  The code used to create "App_data.mat" from the results of spectral analysis is available here: https://github.com/rylarsen/InfantCRefAnalysis.  This code can also be used to re-create all figures and tables from the publication in NMR in Biomedicine.     

APP DETAILS:

This app can be used to calculculate combined reference metabolite ratios (R_CRef) or concentrations (C_CRef) from single subject data. Calculated values of R_CRef and C_CRef are compared with normative data to estimate a percentile for each metabolite. 

The calculations and plots can be performed either using user-provided data or data from any individual scan from the database.  The switch in the upper left panel can be used to toggle between these options. When "user-provided data" is selected the metabolite signal values become editable.  

User-provided data should be acquired using the protocol and voxel placement described in the publication.  For more discussion, see the publication.

The metabolite signal is the result of an integration of either the metabolite spectrum or a fit to the metabolite spectrum, and it has been corrected for the number of protons per molecule, such that the signal is proportional to the number of molecules.  Signal intensity values for the normative data were generated by LCModel using the protocol described in the publication. 

The "Reference" boxes next to the metabolite signal fields are used to specify which metabolites are to be used as references. Any number of reference metabolties can be used, including a single reference. The same references will be used for both the individual subject data and for the normative data.    

The postmenstrual age is given by the chronological age of the child (time since birth) plus the gestation age at birth of the child.

The “Plot metabolite ratios” button plots all metabolite ratios.  Data from the individual infant are displayed by the red markers and data from the typically developing infants are displayed by the black markers.  The solid lines indicate typical aging trajectories, and the dashed lines show one standard deviation above and below the expectation values.  These standard deviation values are used to calculate the shown percentiles for each metabolite, assuming a normal distribution.  

The "Plot Molality Estimates" button rescales the data to units of molality which are mmol/kg of solvent. The black errorbars estimate the uncertainty associated with using metabolite ratios to estimate molality. Our molality estimates are done by assuming that the concentrations of the reference metabolites are equal to the concentration that is expected for an infant of the given age.  Average or expected molality values were obtained by performing water-scaled measurements, in which the water signal was corrected for partial volume and T2 effects.  These measurements were obtained from subjects 1-71 in the database.  
For these 71 scans, it is possible see the individual results of are molality measurements using the "Plot Molality Estimates + Measured Molality Values".  When this button is pressed, the molality estimates are superimposed by green diamonds that show the true concentration values for the infant you are studying.  The blue dotted lines show the average age dependence of the true concentration values calculated from the 71 scans.  The 71 scans with true concentration values are ordered from the scan with the most accurate molality estimates (scan 1), to the scan with the least accurate molality estimates (scan 71).   
  
The data described in the paper included 183 scan sessions, including two for which GABA measurements were discarded.  These two scan sessions are not included in the calculations provided by this app.
